---
title: webpackä½¿ç”¨
tags: [ webpack]
categories: çŸ¥è¯† 
---
#ä»€ä¹ˆæ˜¯ webpack?
![what-is-webpack](https://i.loli.net/2019/01/12/5c39eb56b9248.png)
[webpack](https://www.webpackjs.com/concepts/)æ˜¯ä¸€ä¸ªé™æ€æ–‡ä»¶æ‰“åŒ…å™¨.å½“ webpack å¤„ç†åº”ç”¨ç¨‹åºæ—¶ï¼Œå®ƒä¼šé€’å½’åœ°æ„å»ºä¸€ä¸ªä¾èµ–å…³ç³»å›¾(dependency graph)ï¼Œå…¶ä¸­åŒ…å«åº”ç”¨ç¨‹åºéœ€è¦çš„æ¯ä¸ªæ¨¡å—ï¼Œç„¶åå°†æ‰€æœ‰è¿™äº›æ¨¡å—æ‰“åŒ…æˆä¸€ä¸ªæˆ–å¤šä¸ª bundle.
webpack æœ‰å››ä¸ªæ ¸å¿ƒæ¦‚å¿µ:
* å…¥å£(entry)
* è¾“å‡º(output)
* loader
* æ’ä»¶(plugins)

æ­¤å¤–,åœ¨ webpack4ä¸­,å¢åŠ äº† mode çš„é€‰é¡¹,é€šè¿‡é€‰æ‹© development æˆ– production ä¹‹ä¸­çš„ä¸€ä¸ªï¼Œæ¥è®¾ç½® mode å‚æ•°ï¼Œä½ å¯ä»¥å¯ç”¨ç›¸åº”æ¨¡å¼ä¸‹çš„ webpack å†…ç½®çš„ä¼˜åŒ–.
##å…¥å£èµ·ç‚¹(entry point)
### å•ä¸ªå…¥å£å†™æ³•
ç”¨æ³•:`entry: string|Array<string>`
åœ¨ webpack.config.js ä¸­é…ç½®:

    const config = {
    entry: './path/to/my/entry/file.js'
    };

    module.exports = config;
ä¸Šé¢è¿™ç§ entry çš„å†™æ³•æ˜¯ğŸ‘‡çš„ç®€å†™:

    const config = {
    entry: {
        main: './path/to/my/entry/file.js'
    }
    };
å‘ entry ä¼ å…¥æ•°ç»„,ä¼šåˆ›å»ºå¤šä¸ªä¸»å…¥å£(multi-main entry).
### å¯¹è±¡è¯­æ³•
ç”¨æ³•:`entry: {[entryChunkName: string]: string|Array<string>}`
åœ¨ webpack.config.jsä¸­é…ç½®:

    const config = {
    entry: {
        app: './src/app.js',
        vendors: './src/vendors.js'
    }
    };
### å¸¸è§åœºæ™¯
#### åˆ†ç¦»åº”ç”¨ç¨‹åº(app)å’Œç¬¬ä¸‰æ–¹åº“(vendor)å…¥å£
åœ¨ webpack.config.js ä¸­é…ç½®:

    const config = {
    entry: {
        app: './src/app.js',
        vendors: './src/vendors.js'
    }
    };
 *webpack ä» app.js å’Œ vendors.js å¼€å§‹åˆ›å»ºä¾èµ–å›¾(dependency graph)ã€‚è¿™äº›ä¾èµ–å›¾æ˜¯å½¼æ­¤å®Œå…¨åˆ†ç¦»ã€äº’ç›¸ç‹¬ç«‹çš„ï¼ˆæ¯ä¸ª bundle ä¸­éƒ½æœ‰ä¸€ä¸ª webpack å¼•å¯¼(bootstrap)ï¼‰ã€‚è¿™ç§æ–¹å¼æ¯”è¾ƒå¸¸è§äºï¼Œåªæœ‰ä¸€ä¸ªå…¥å£èµ·ç‚¹ï¼ˆä¸åŒ…æ‹¬ vendorï¼‰çš„å•é¡µåº”ç”¨ç¨‹åº(single page application)ä¸­ã€‚*
 #### å¤šé¡µé¢åº”ç”¨ç¨‹åº
 åœ¨ webpack.config.jsä¸­é…ç½®:

    const config = {
    entry: {
        pageOne: './src/pageOne/index.js',
        pageTwo: './src/pageTwo/index.js',
        pageThree: './src/pageThree/index.js'
    }
    };
*webpack éœ€è¦ 3 ä¸ªç‹¬ç«‹åˆ†ç¦»çš„ä¾èµ–å›¾ï¼ˆå¦‚ä¸Šé¢çš„ç¤ºä¾‹ï¼‰ã€‚*
## è¾“å‡º(OUTPUT)
é…ç½® output é€‰é¡¹å¯ä»¥æ§åˆ¶ webpack å¦‚ä½•å‘ç¡¬ç›˜å†™å…¥ç¼–è¯‘æ–‡ä»¶.å³æ—¶å­˜åœ¨å¤šä¸ªå…¥å£èµ·ç‚¹,ä½†åªæŒ‡å®šä¸€ä¸ªè¾“å‡ºé…ç½®.
### ç”¨æ³•
åœ¨ webpack ä¸­é…ç½® output å±æ€§çš„æœ€ä½è¦æ±‚æ˜¯,å°†å®ƒçš„å€¼è®¾ç½®ä¸ºä¸€ä¸ªå¯¹è±¡,åŒ…æ‹¬ä»¥ä¸‹ä¸¤ç‚¹:
* filename ç”¨äºè¾“å‡ºæ–‡ä»¶çš„æ–‡ä»¶å;
* ç›®æ ‡è¾“å‡ºç›®å½• path çš„ç»å¯¹è·¯å¾„.

åœ¨ webpack.config.js ä¸­é…ç½®

    module.exports = {
    output: {
        filename: 'bundle.js',
        path: '/home/proj/public/assets'
    }
    };
### å¤šä¸ªå…¥å£èµ·ç‚¹
å¦‚æœé…ç½®äº†å¤šä¸ªå•ç‹¬çš„ chunk,åˆ™åº”è¯¥ä½¿ç”¨å ä½ç¬¦æ¥ç¡®ä¿æ¯ä¸ªæ–‡ä»¶å…·æœ‰å”¯ä¸€çš„åç§°.
module.exports = {
  entry: {
    app: './src/app.js',
    search: './src/search.js'
  },
  output: {
    filename: '[name].js',
    path: __dirname + '/dist'
  }
};

// å†™å…¥åˆ°ç¡¬ç›˜ï¼š./dist/app.js, ./dist/search.js
## æ¨¡å¼
æä¾› mode é…ç½®é€‰é¡¹,å‘ŠçŸ¥ webpack ä½¿ç”¨ç›¸åº”æ¨¡å¼çš„å†…ç½®ä¼˜åŒ–.
### ç”¨æ³•
åªåœ¨é…ç½®ä¸­æä¾› node é€‰é¡¹:

    module.export = {
        mode:'production'
    }
æˆ–è€…åœ¨ cli å‚æ•°ä¸­ä¼ é€’:
`webpack --mode=production`
æ”¯æŒä¸€ä¸‹å­—ç¬¦ä¸²:
#### development
ä¼šå°† process.env.NODE_ENV çš„å€¼è®¾ä¸º developmentã€‚å¯ç”¨ NamedChunksPlugin å’Œ NamedModulesPluginã€‚
#### production
ä¼šå°† process.env.NODE_ENV çš„å€¼è®¾ä¸º productionã€‚å¯ç”¨ FlagDependencyUsagePlugin, FlagIncludedChunksPlugin, ModuleConcatenationPlugin, NoEmitOnErrorsPlugin, OccurrenceOrderPlugin, SideEffectsFlagPlugin å’Œ UglifyJsPlugin.
#### none
ä¸é€‰ç”¨ä»»ä½•é»˜è®¤ä¼˜åŒ–é€‰é¡¹
## loader
loader ç”¨äºå¯¹æ¨¡å—çš„æºä»£ç è¿›è¡Œè½¬æ¢.loader å¯ä»¥ä½¿ä½ åœ¨ import æˆ–åŠ è½½æ¨¡å—æ—¶é¢„å¤„ç†æ–‡ä»¶.å› æ­¤ loader ç±»ä¼¼äºæ›¿ä»–æ„å»ºå·¥å…·ä¸­çš„ä»»åŠ¡(tesk),å¹¶æä¾›äº†å¤„ç†å‰ç«¯æ„å»ºæ­¥éª¤çš„å¼ºå¤§æ–¹æ³•.loader å¯ä»¥å°†æ–‡ä»¶ä»ä¸åŒçš„è¯­è¨€è½¬åŒ–æˆ JavaScript.
### å®ä¾‹
å¯ä»¥ä½¿ç”¨ loader å‘Šè¯‰ webpack åŠ è½½ css æ–‡ä»¶,ä¸ºæ­¤é¦–å…ˆå®‰è£…ç›¸å¯¹åº”çš„ loader.
`npm install css-loader -D`
`npm install ts-loader -D `

    //webpack.config.js
    module.exports = {
    module: {
        rules: [
        { test: /\.css$/, use: 'css-loader' },
        { test: /\.ts$/, use: 'ts-loader' }
        ]
    }
    };
### ä½¿ç”¨ loader
æœ‰ä¸‰ç§ ä½¿ç”¨ loader çš„æ–¹å¼:
* é…ç½®>åœ¨ webpack.config.jsæ–‡ä»¶ä¸­æŒ‡å®š lodaer.
* å†…è”>åœ¨æ¯ä¸ª import è¯­å¥ä¸­æ˜¾å¼æŒ‡å®š loader.
* cli>åœ¨ shell å‘½ä»¤ä¸­æŒ‡å®šä»–ä»¬.
#### é…ç½®[configuration]

    module.exports = {
    module: {
        rules: [
        {
            test: /\.css$/,
            use: [
            { loader: 'style-loader' },
            {
                loader: 'css-loader',
                options: {
                modules: true
                }
            }
            ]
        }
        ]
    }
    };
#### å†…è”
å¯ä»¥åœ¨ import è¯­å¥æˆ–è€…ä»»ä½•ç­‰æ•ˆäº import çš„æ–¹å¼ä¸­æŒ‡å®š lodaer.ä½¿ç”¨ ! æ¥å°†èµ„æºä¸­çš„ loader åˆ†å¼€.åˆ†å¼€çš„æ¯ä¸ªéƒ¨åˆ†éƒ½ç›¸å¯¹äºå½“å‰ç›®å½•è§£æ.
`import Styles from 'style-loader!css-loader?modules!./styles.css';`
#### cli
`webpack --module-bind jade-loader --module-bind 'css=style-loader!css-loader'`
è¿™ä¼šå¯¹ .jade æ–‡ä»¶ä½¿ç”¨ jade-loader,å¯¹ .css æ–‡ä»¶ä½¿ç”¨ style-loader å’Œ css-loader.
### loaderç‰¹æ€§
* loader æ”¯æŒé“¾å¼ä¼ è¾“,loader é“¾ä¸­æ¯ä¸ª loader,éƒ½å¯¹å‰ä¸€ä¸ª loader å¤„ç†åçš„èµ„æºè¿›è¡Œè½¬æ¢.
 * loader å¯ä»¥æ˜¯åŒæ­¥çš„,ä¹Ÿå¯ä»¥æ˜¯å¼‚æ­¥çš„.
 * loader å¯ä»¥è¿è¡Œåœ¨ node.jsä¸­,å¹¶ä¸”èƒ½å¤Ÿæ‰§è¡Œä»»ä½•å¯èƒ½çš„æ“ä½œ.
 * loader æ¥å—æŸ¥è¯¢å‚æ•°.
 * loader èƒ½å¤Ÿä½¿ç”¨ options å¯¹è±¡è¿›è¡Œé…ç½®.
 * é™¤äº†ä½¿ç”¨package,json å¸¸è§çš„ main å±æ€§,è¿˜å¯ä»¥å°†æ™®é€šçš„ npm æ¨¡å—å¯¼å‡ºä¸º loader,åšæ³•æ˜¯åœ¨ package.jsonä¸­å®šä¹‰ä¸€ä¸ª lodaer å­—æ®µ.
 * æ’ä»¶(plugins)å¯ä»¥ä¸º loader å¸¦æ¥æ›´å¤šç‰¹æ€§.
 * loader èƒ½å¤Ÿäº§ç”Ÿé¢å¤–çš„ä»»æ„æ–‡ä»¶.
## æ’ä»¶(æš‚æ—¶è·³è¿‡)
## é…ç½®[configuration]
webpack çš„é…ç½®æ–‡ä»¶,æ˜¯å¯¼å‡ºä¸€ä¸ªå¯¹è±¡çš„ JavaScript æ–‡ä»¶,æ­¤å¯¹è±¡ç”± webpack æ ¹æ®å¯¹è±¡å®šä¹‰çš„å±æ€§è¿›è¡Œè§£æ.
å› ä¸º webpack æ˜¯æ ‡å‡†çš„ node.js commonJS æ¨¡å—,å› æ­¤å¯ä»¥:
* é€šè¿‡ require å¯¼å…¥å…¶ä»–æ–‡ä»¶.
* é€šè¿‡ require ä½¿ç”¨ npmçš„å·¥å…·å‡½æ•°.
* ä½¿ç”¨ JavaScript æ§åˆ¶æµè¡¨è¾¾å¼.
* å¯¹å¸¸ç”¨å€¼ä½¿ç”¨å¸¸é‡æˆ–è€…å˜é‡.
* ç¼–å†™å¹¶æ‰§è¡Œå‡½æ•°æ¥ç”Ÿæˆéƒ¨åˆ†é…ç½®.
### åŸºæœ¬é…ç½®

    //webpack.config.js
    var path = require('path');
    module.exports = {
    mode: 'development',
    entry: './foo.js',
    output: {
        path: path.resolve(__dirname, 'dist'),
        filename: 'foo.bundle.js'
    }
    };
## æ¨¡å—(modules)
åœ¨æ¨¡å—åŒ–ç¼–ç¨‹ä¸­,å¼€å‘è€…å°†ç¨‹åºåˆ†è§£æˆç¦»æ•£åŠŸèƒ½å—,å¹¶ç§°ä¹‹ä¸ºæ¨¡å—.
### webpackæ¨¡å—
*  ES 2015  import è¯­å¥
* CommonJS require()è¯­å¥
* AMD define å’Œ require è¯­å¥
* css/sass/less æ–‡ä»¶ä¸­çš„@import è¯­å¥
* æ ·å¼æˆ– html æ–‡ä»¶ä¸­çš„å›¾ç‰‡é“¾æ¥