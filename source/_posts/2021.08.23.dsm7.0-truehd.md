---
title: 群辉dsm7.0 videoStation启用truehd/dts音轨
tags: [videostation]
categories: 随笔
---

通过安装`dsm7.0`对应的 `ffmpeg`,启用videostation对dts/truehd等音轨的支持.

`ds218+`实测成功.

效果如下:

![img](https://i.loli.net/2021/08/23/qQIlXz75fRxVN2D.png)

## 操作流程

### 确认设备型号

首先到这个页面[https://github.com/SynoCommunity/spksrc/wiki/Architecture-per-Synology-model](https://github.com/SynoCommunity/spksrc/wiki/Architecture-per-Synology-model)

确认自己群辉nas的型号.

接着到 [https://github.com/th0ma7/synology/tree/master/packages/dsm7-beta](https://github.com/th0ma7/synology/tree/master/packages/dsm7-beta)

找到对应的spk文件,下载,并在套件中心手动安装

![img](https://i.loli.net/2021/08/23/2kepPU4bB7qWauo.png)

### 安装插件

通过ssh连接到群辉,并切换到root

```sh
sudo -i
```

接着进行如下的操作:

```sh
#备份 VideoStation's ffmpeg
mv -n /var/packages/VideoStation/target/bin/ffmpeg /var/packages/VideoStation/target/bin/ffmpeg.orig
#下载ffmpeg脚本
wget -O - https://gist.githubusercontent.com/BenjaminPoncet/bbef9edc1d0800528813e75c1669e57e/raw/ffmpeg-wrapper > /var/packages/VideoStation/target/bin/ffmpeg
#设置脚本相应权限
chown root:VideoStation /var/packages/VideoStation/target/bin/ffmpeg
chmod 750 /var/packages/VideoStation/target/bin/ffmpeg
chmod u+s /var/packages/VideoStation/target/bin/ffmpeg
# 备份VideoStation's libsynovte.so
cp -n /var/packages/VideoStation/target/lib/libsynovte.so /var/packages/VideoStation/target/lib/libsynovte.so.orig
chown VideoStation:VideoStation /var/packages/VideoStation/target/lib/libsynovte.so.orig
# 为libsynovte.so 添加 DTS, EAC3 and TrueHD支持
sed -i -e 's/eac3/3cae/' -e 's/dts/std/' -e 's/truehd/dheurt/' /var/packages/VideoStation/target/lib/libsynovte.so
#备份CodecPack的ffmpeg41
cp /var/packages/CodecPack/target/bin/ffmpeg41 /var/packages/CodecPack/target/bin/ffmpeg41.bak
#链接ffmpeg解码模块
cp /var/packages/VideoStation/target/bin/ffmpeg /var/packages/CodecPack/target/bin/ffmpeg41
```

接着重启videostation,让ffmpeg更新生效.

### 还原操作与卸载

```sh
#恢复之前备份的 VideoStation's ffmpeg, libsynovte.so, ffmpeg41文件
mv -f /var/packages/VideoStation/target/bin/ffmpeg.orig /var/packages/VideoStation/target/bin/ffmpeg
mv -f /var/packages/VideoStation/target/lib/libsynovte.so.orig /var/packages/VideoStation/target/lib/libsynovte.so
mv -f /var/packages/CodecPack/target/bin/ffmpeg41.bak /var/packages/CodecPack/target/bin/ffmpeg41
```

