---
title: 在树莓派中使用homebridge
tags: [raspberry,homebridge,nodejs]
categories: 随笔
---

# 安装树莓派系统



将sd卡插入电脑

官方下载页面[https://www.raspberrypi.org/downloads/](https://www.raspberrypi.org/downloads/)

直接选择自己操作系统需要的安装包并进行烧录操作即可  

![img](https://i.loli.net/2021/07/22/KDkPaiyQ4Ho9Ftr.png)

通过上面的工具,可以选择对应的镜像进行下载,也可以通过这里[https://www.raspberrypi.org/downloads/](https://www.raspberrypi.org/downloads/)来手动下载镜像.

写入完成后软件提示可以拔出sd卡,这个时候系统安装完成,将sd卡插入到树莓派就完成了.

# 为树莓派设置wifi连接&SSH

## wifi

### 第一次开机前

将sd连接电脑,在 /boot下新建一个`wpa_supplicant.conf`文件,文件中的内容如下:

```conf
country=CN
ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev
update_config=1
 
network={
ssid="WiFi-A"
psk="12345678"
key_mgmt=WPA-PSK
priority=1
}
 
network={
ssid="WiFi-B"
psk="12345678"
key_mgmt=WPA-PSK
priority=2
scan_ssid=1
}

#ssid:网络的ssid
#psk:密码
#priority:连接优先级，数字越大优先级越高（不可以是负数）
#scan_ssid:连接隐藏WiFi时需要指定该值为1


```



如果你的 WiFi 没有密码

```
network={``ssid="你的无线网络名称（ssid）"``key_mgmt=NONE``}
```

如果你的 WiFi 使用WEP加密

```
network={``ssid="你的无线网络名称（ssid）"``key_mgmt=NONE``wep_key0="你的wifi密码"``}
```

如果你的 WiFi 使用WPA/WPA2加密

```
network={``ssid="你的无线网络名称（ssid）"``key_mgmt=WPA-PSK``psk="你的wifi密码"``}
```

如果你不清楚 WiFi 的加密模式，可以在安卓手机上用 root explorer 打开 `/data/misc/wifi/wpa/wpa_supplicant.conf`，查看 WiFi 的信息。

### 有线连接下配置wifi

```sh
sudo nano /etc/wpa_supplicant/wpa_supplicant.conf
```

在文件底部添加(可以添加多个):

```conf
network={
ssid="The SSID of your network (eg. Network name)"
psk="Your Wifi Password"
}
```

输入`ctrl+ x`, 然后输入`y`退出`nano`

如果没有自动连接wifi的话,可以尝试关闭/开启wifi来重试:

```sh
sudo ifdown wlan0
sudo ifup wlan0
```



## SSH

如果通过 ssh 连接树莓派出现 Access denied 这个提示则说明 ssh 服务没有开启。要手动开启的话，和 WiFi 配置相似，同样在 boot 分区新建一个文件，空白的即可，文件命名为 ssh。注意要小写且不要有任何扩展名。

# 安装 nodejs

## 方法1

到nodejs官网[https://nodejs.org/en/download/](https://nodejs.org/en/download/)

下载树莓派对应的版本:

![img](https://i.loli.net/2021/07/22/57wIFOSxPg3jBtC.png)

复制对应的下载连接,然后在`/home/pi`下执行:

```sh
wget https://nodejs.org/dist/v14.17.3/node-v14.17.3-linux-armv7l.tar.xz
```

解压:

```sh
tar -xvf node-v14.17.3-linux-armv7l
```

配置环境变量:

```sh
vi .bash_profile
# 如果没有.bash_profile 就新建一个.
```

在`.bash_profile`中添加下面的内容:

```sh
export NODE_HOME=/home/pi/node-v14.17.3-linux-armv7l
export PATH=$PATH:$NODE_HOME/bin 
export NODE_PATH=$NODE_HOME/lib/node_modules
```

接着执行:

```sh
source .bash_profile
```

接着在任意目录下可以使用node了:

![img](https://i.loli.net/2021/07/22/Hq9Ij7DF8NaxwA5.png)

## 方法2

```sh
# 设置源
curl -sL https://deb.nodesource.com/setup_14.x | sudo bash -
# 安装 nodejs
sudo apt install -y nodejs gcc g++ make python net-tools
# 测试是否安装成功
node -v
```





# 安装avahi

```sh
sudo apt-get install libavahi-compat-libdnssd-dev
```



# 安装 homebridge

```sh
sudo npm install -g --unsafe-perm homebridge homebridge-config-ui-x
```

安装 `homebridge-service`以便`homebridge`开机自启:

```sh
sudo hb-service install --user homebridge
```

# 安装插件

## homebridge-sensor-th

[https://www.npmjs.com/package/homebridge-sensor-th](https://www.npmjs.com/package/homebridge-sensor-th)

实现传感器接到树莓派,并接入 homebridge 的功能.

可以获取到当前传感器的温度和湿度数据

## homebridge-broadlink-rm

将博联红外遥控器接入到 homebridge,可以遥控空调/电视等设备

## homebridge-bravia-tvos

将索尼电视接入 homeBridge

## homebridge-raspberrypi-temperature

显示树莓派温度

